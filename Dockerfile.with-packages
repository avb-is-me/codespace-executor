# Custom Docker Image with Pre-installed Libraries
#
# This Dockerfile creates a distroless image with specific npm packages
# pre-installed for faster execution.

# Stage 1: Build with package manager
FROM node:20-alpine AS builder

WORKDIR /app

# Install your required npm packages
RUN npm install --omit=dev \
    stripe \
    axios \
    lodash \
    moment \
    openai \
    @aws-sdk/client-s3

# Stage 2: Copy to distroless (Node.js only)
FROM gcr.io/distroless/nodejs20-debian12

# Copy Node.js modules from builder
COPY --from=builder /app/node_modules /app/node_modules

# Set NODE_PATH so require() can find modules
ENV NODE_PATH=/app/node_modules

# Result: Distroless image with ONLY Node.js + your specific packages
# No shell, no Python, no package manager - just Node.js + libraries
